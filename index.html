<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration Planning Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2C2C2C 0%, #1A1A1A 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 25px;
            height: 15px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #86BC25, #6FA01F);
            height: 100%;
            border-radius: 25px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: #333;
            z-index: 1;
            font-size: 0.8rem;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .timeline-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 30px;
        }

        .phase-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .phase-section-header {
            padding: 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-bottom: 2px solid #dee2e6;
            transition: all 0.3s ease;
            position: relative;
        }

        .phase-section-header:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
        }

        .phase-section-header.pre-cutover {
            background: linear-gradient(135deg, #86BC25, #6FA01F);
            color: white;
        }

        .phase-section-header.pre-cutover:hover {
            background: linear-gradient(135deg, #6FA01F, #5A8A19);
        }

        .phase-section-header.during-cutover {
            background: linear-gradient(135deg, #2C2C2C, #1A1A1A);
            color: white;
        }

        .phase-section-header.during-cutover:hover {
            background: linear-gradient(135deg, #1A1A1A, #000000);
        }

        .phase-title-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .phase-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }

        .expand-collapse-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
            color: inherit;
        }

        .expand-collapse-icon.expanded {
            transform: rotate(180deg);
        }

        .phase-status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.7;
        }

        .phase-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.3s ease;
            padding: 0 25px;
        }

        .phase-content.expanded {
            max-height: 5000px; /* Large enough to accommodate content */
            padding: 25px;
        }

        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .phase-actions {
            display: flex;
            gap: 10px;
        }

        .add-task-btn, .add-milestone-btn, .add-note-btn {
            background: linear-gradient(45deg, #86BC25, #6FA01F);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(134,188,37,0.3);
        }

        .add-milestone-btn {
            background: linear-gradient(45deg, #2C2C2C, #1A1A1A);
            box-shadow: 0 4px 15px rgba(44,44,44,0.3);
        }

        .add-note-btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }

        .add-task-btn:hover, .add-milestone-btn:hover, .add-note-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(134,188,37,0.4);
        }

        .notes-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #212529;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(108,117,125,0.3);
            border: 2px solid #dee2e6;
        }

        .note-item {
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #6c757d;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .note-content {
            flex: 1;
            margin-right: 15px;
        }

        .note-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #212529;
        }

        .note-text {
            opacity: 0.8;
            line-height: 1.4;
            color: #495057;
        }

        .note-timestamp {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 8px;
            color: #6c757d;
        }

        .notes-section h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .note-actions {
            display: flex;
            gap: 8px;
        }

        /* Process Timeline Styles */
        .process-timeline-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #86BC25;
        }

        .process-timeline-section h3 {
            color: #86BC25;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .timeline-scroll-container {
            overflow-y: visible;
            padding: 20px 0;
        }

        .horizontal-timeline {
            display: flex;
            gap: 20px;
            position: relative;
            padding: 20px 0;
            flex-wrap: wrap;
        }

        .timeline-entry {
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 15px;
            min-width: 200px;
            max-width: 250px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .timeline-entry.all-checked {
            border-color: #28a745;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
        }

        .timeline-entry:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #86BC25;
        }

        .timeline-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .timeline-entry-title {
            font-weight: bold;
            font-size: 1rem;
            color: #495057;
            flex: 1;
            margin-right: 10px;
        }

        .timeline-entry-flags {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .timeline-flag {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            text-align: center;
            min-width: 40px;
        }

        .timeline-flag.male {
            background: #007bff;
            color: white;
        }

        .timeline-flag.lk {
            background: #28a745;
            color: white;
        }

        .timeline-entry-period {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .timeline-entry-template {
            font-size: 0.8rem;
            color: #86BC25;
            font-weight: bold;
            background: rgba(134, 188, 37, 0.1);
            padding: 3px 8px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: inline-block;
        }

        .timeline-checkboxes {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #dee2e6;
            margin-top: 15px;
        }

        .timeline-checkbox-item {
            display: flex;
            align-items: center;
            padding: 6px 0;
            transition: background-color 0.2s ease;
        }

        .timeline-checkbox-item.hidden-by-logic {
            display: none;
        }

        .timeline-checkbox-item:hover {
            background: rgba(134, 188, 37, 0.05);
            border-radius: 4px;
            margin: 0 -5px;
            padding-left: 5px;
            padding-right: 5px;
        }

        .timeline-checkbox {
            margin-right: 10px;
            width: 16px;
            height: 16px;
            accent-color: #86BC25;
        }

        .timeline-checkbox-label {
            font-size: 0.85rem;
            color: #495057;
            cursor: pointer;
            user-select: none;
        }

        .timeline-entry-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .timeline-entry:hover .timeline-entry-actions {
            opacity: 1;
        }

        .timeline-action-btn {
            background: rgba(108, 117, 125, 0.8);
            color: white;
            border: none;
            padding: 4px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.7rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .timeline-action-btn.edit:hover {
            background: #007bff;
        }

        .timeline-action-btn.delete:hover {
            background: #dc3545;
        }

        .timeline-scroll-container::-webkit-scrollbar {
            height: 8px;
        }

        .timeline-scroll-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .timeline-scroll-container::-webkit-scrollbar-thumb {
            background: #86BC25;
            border-radius: 4px;
        }

        .timeline-scroll-container::-webkit-scrollbar-thumb:hover {
            background: #6FA01F;
        }

        .filters-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            font-size: 0.9rem;
            font-weight: bold;
            color: #495057;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 0.9rem;
            min-width: 150px;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #86BC25;
        }

        .clear-filters-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        .clear-filters-btn:hover {
            background: #545b62;
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-top: 20px;
        }

        .tasks-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .timeline-section {
            background: #ffffff;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #86BC25;
        }

        .timeline-section h3 {
            color: #86BC25;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .timeline-visual {
            position: relative;
            padding: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #dee2e6;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .timeline-date {
            width: 60px;
            font-size: 0.8rem;
            font-weight: bold;
            color: #6c757d;
            text-align: center;
        }

        .timeline-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin: 0 15px;
            position: relative;
            z-index: 1;
        }

        .timeline-dot.milestone {
            background: #86BC25;
            border: 4px solid white;
            box-shadow: 0 0 0 3px #86BC25, 0 2px 8px rgba(134,188,37,0.3);
            width: 20px;
            height: 20px;
        }

        .timeline-dot.task-completed {
            background: #28a745;
        }

        .timeline-dot.task-progress {
            background: #ffc107;
        }

        .timeline-dot.task-not-started {
            background: #6c757d;
        }

        .timeline-content {
            flex: 1;
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid transparent;
        }

        .timeline-content.milestone-content {
            background: linear-gradient(135deg, #86BC25, #6FA01F);
            color: white;
            border-left: 4px solid #6FA01F;
            font-weight: bold;
        }

        .milestones-highlight {
            background: linear-gradient(135deg, #86BC25, #6FA01F);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(134,188,37,0.3);
        }

        .milestones-highlight h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-align: center;
        }

        .milestone-item {
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .milestone-item:last-child {
            margin-bottom: 0;
        }

        .milestone-title {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .milestone-datetime {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .milestone-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .task-item {
            background: #ffffff;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.8;
            border-left-color: #28a745;
        }

        .task-item.in-progress {
            border-left-color: #ffc107;
        }

        .task-item.not-started {
            border-left-color: #6c757d;
        }

        .task-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .task-header:hover {
            background: #f1f3f4;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
        }

        .task-meta {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .task-assignee {
            background: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .task-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-icon-btn {
            background: #f8f9fa;
            color: #6c757d;
            border: none;
            padding: 6px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .task-icon-btn.edit:hover {
            background: #007bff;
            color: white;
        }

        .task-icon-btn.delete:hover {
            background: #dc3545;
            color: white;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-in-progress {
            background: #fff3cd;
            color: #856404;
        }

        .status-not-started {
            background: #8d8b8b;
            color: #ffffff;
        }

        .task-details {
            padding: 20px;
            background: #f8f9fa;
            display: none;
        }

        .task-details.expanded {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Fade in animation for expanded phase content */
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .phase-content.expanded > * {
            animation: fadeInUp 0.6s ease forwards;
        }

        .subtask {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            group: 1;
        }

        .subtask:last-child {
            border-bottom: none;
        }

        .subtask-checkbox {
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }

        .subtask-text {
            flex: 1;
            margin-right: 15px;
        }

        .subtask-assignee {
            background: #e9ecef;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            color: #495057;
            margin-right: 10px;
        }

        .subtask-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: background-color 0.3s ease;
        }

        .subtask-delete-btn:hover {
            background: #c82333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            margin: 50px auto;
            position: relative;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #495057;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6c757d;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }

        .form-input, .form-textarea, .form-select, .form-datetime {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus, .form-datetime:focus {
            outline: none;
            border-color: #86BC25;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #86BC25, #6FA01F);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(134,188,37,0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-right: 10px;
        }

        .subtask-list {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .subtask-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .subtask-input {
            flex: 1;
        }

        .assignee-input {
            width: 200px;
        }

        .add-subtask-btn {
            background: #86BC25;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .expand-icon {
            transition: transform 0.3s ease;
        }

        .expand-icon.rotated {
            transform: rotate(180deg);
        }

        .no-results-message {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 15px;
        }

        @media (max-width: 1024px) {
            .content-wrapper {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .timeline-container {
                flex-direction: column;
            }
            
            .container {
                padding: 10px;
            }
            
            .modal-content {
                margin: 20px;
                padding: 20px;
            }

            .phase-actions {
                flex-direction: column;
            }

            .task-actions {
                flex-direction: column;
                gap: 5px;
            }

            .filters-section {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                margin-bottom: 10px;
            }

            .phase-title-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .phase-status-indicator {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Final Cutover Plan</h1>
        </div>

        <div class="timeline-container">
            <!-- Pre-Cutover Section -->
            <div class="phase-section" id="pre-cutover-section">
                <div class="phase-section-header pre-cutover" onclick="togglePhaseSection('pre-cutover')">
                    <div class="phase-title-container">
                        <h2 class="phase-title">Pre-Cutover Planning</h2>
                        <div class="phase-status-indicator">
                            <span class="status-dot"></span>
                            <span id="pre-cutover-section-status">0/0 tasks completed</span>
                        </div>
                    </div>
                    <div class="expand-collapse-icon" id="pre-cutover-icon">▼</div>
                </div>
                
                <div class="phase-content" id="pre-cutover-content">
                    <div class="phase-header">
                        <div class="phase-actions">
                            <button class="add-task-btn" onclick="openAddTaskModal('pre-cutover')">+ Add Task</button>
                            <button class="add-note-btn" onclick="openAddNoteModal('pre-cutover')">+ Add Note</button>
                        </div>
                    </div>

                    <!-- Important Notes Section -->
                    <div class="notes-section" id="pre-cutover-notes-section" style="display: none;">
                        <h3>Important Notes <span id="pre-cutover-notes-count">0</span></h3>
                        <div id="pre-cutover-notes-container">
                            <!-- Notes will be displayed here -->
                        </div>
                    </div>

                    <!-- Process Timeline Section -->
                    <div class="process-timeline-section">
                        <h3>Process Timeline 
                            <button class="add-task-btn" onclick="openAddTimelineEntryModal('pre-cutover')" style="margin-left: 15px; font-size: 0.9rem; padding: 8px 15px;">+ Add Entry</button>
                        </h3>
                        <div class="filters-section">
                            <div class="filter-group">
                                <label class="filter-label">Filter by Region:</label>
                                <select class="filter-select" id="pre-cutover-timeline-region-filter" onchange="applyTimelineFilters('pre-cutover')">
                                    <option value="">All Regions</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Filter by Template Type:</label>
                                <select class="filter-select" id="pre-cutover-timeline-template-filter" onchange="applyTimelineFilters('pre-cutover')">
                                    <option value="">All Templates</option>
                                </select>
                            </div>
                            <button class="clear-filters-btn" onclick="clearTimelineFilters('pre-cutover')">Clear Filters</button>
                        </div>
                        <div class="timeline-scroll-container">
                            <div class="horizontal-timeline" id="pre-cutover-process-timeline">
                                <!-- Timeline entries will be displayed here -->
                            </div>
                        </div>
                    </div>

                    <!-- Filters Section -->
                    <div class="filters-section">
                        <div class="filter-group">
                            <label class="filter-label">Filter by Status:</label>
                            <select class="filter-select" id="pre-cutover-status-filter" onchange="applyFilters('pre-cutover')">
                                <option value="">All Statuses</option>
                                <option value="completed">Completed</option>
                                <option value="in-progress">In Progress</option>
                                <option value="not-started">Not Started</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Filter by Assignee:</label>
                            <select class="filter-select" id="pre-cutover-assignee-filter" onchange="applyFilters('pre-cutover')">
                                <option value="">All Assignees</option>
                            </select>
                        </div>
                        <button class="clear-filters-btn" onclick="clearFilters('pre-cutover')">Clear Filters</button>
                    </div>

                    <div class="progress-section">
                        <h4>Pre-Cutover Progress</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="preCutoverProgress" style="width: 0%"></div>
                            <div class="progress-text" id="preCutoverProgressText">0% Complete</div>
                        </div>
                        <div class="progress-stats">
                            <div><strong>Total:</strong> <span id="preCutoverTotalTasks">0</span></div>
                            <div><strong>Completed:</strong> <span id="preCutoverCompletedTasks">0</span></div>
                            <div><strong>Remaining:</strong> <span id="preCutoverRemainingTasks">0</span></div>
                        </div>
                    </div>
                    
                    <div class="content-wrapper">
                        <div class="tasks-section">
                            <h3>Tasks</h3>
                            <div id="pre-cutover-tasks" class="tasks-container">
                                <!-- Tasks will be dynamically loaded here -->
                            </div>
                        </div>
                        <div class="timeline-section">
                            <h3>Timeline View</h3>
                            <div class="timeline-visual" id="pre-cutover-timeline">
                                <div class="timeline-line"></div>
                                <!-- Timeline items will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- During Cutover Section -->
            <div class="phase-section" id="during-cutover-section">
                <div class="phase-section-header during-cutover" onclick="togglePhaseSection('during-cutover')">
                    <div class="phase-title-container">
                        <h2 class="phase-title">During Cutover Execution</h2>
                        <div class="phase-status-indicator">
                            <span class="status-dot"></span>
                            <span id="during-cutover-section-status">0/0 tasks completed</span>
                        </div>
                    </div>
                    <div class="expand-collapse-icon" id="during-cutover-icon">▼</div>
                </div>
                
                <div class="phase-content" id="during-cutover-content">
                    <div class="phase-header">
                        <div class="phase-actions">
                            <button class="add-task-btn" onclick="openAddTaskModal('during-cutover')">+ Add Task</button>
                            <button class="add-milestone-btn" onclick="openAddMilestoneModal()">+ Add Milestone</button>
                            <button class="add-note-btn" onclick="openAddNoteModal('during-cutover')">+ Add Note</button>
                        </div>
                    </div>

                    <!-- Important Notes Section -->
                    <div class="notes-section" id="during-cutover-notes-section" style="display: none;">
                        <h3>Important Notes <span id="during-cutover-notes-count">0</span></h3>
                        <div id="during-cutover-notes-container">
                            <!-- Notes will be displayed here -->
                        </div>
                    </div>

                    <!-- Process Timeline Section -->
                    <div class="process-timeline-section">
                        <h3>Process Timeline 
                            <button class="add-task-btn" onclick="openAddTimelineEntryModal('during-cutover')" style="margin-left: 15px; font-size: 0.9rem; padding: 8px 15px;">+ Add Entry</button>
                        </h3>
                        <div class="filters-section">
                            <div class="filter-group">
                                <label class="filter-label">Filter by Region:</label>
                                <select class="filter-select" id="during-cutover-timeline-region-filter" onchange="applyTimelineFilters('during-cutover')">
                                    <option value="">All Regions</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Filter by Template Type:</label>
                                <select class="filter-select" id="during-cutover-timeline-template-filter" onchange="applyTimelineFilters('during-cutover')">
                                    <option value="">All Templates</option>
                                </select>
                            </div>
                            <button class="clear-filters-btn" onclick="clearTimelineFilters('during-cutover')">Clear Filters</button>
                        </div>
                        <div class="timeline-scroll-container">
                            <div class="horizontal-timeline" id="during-cutover-process-timeline">
                                <!-- Timeline entries will be displayed here -->
                            </div>
                        </div>
                    </div>

                    <!-- Filters Section -->
                    <div class="filters-section">
                        <div class="filter-group">
                            <label class="filter-label">Filter by Status:</label>
                            <select class="filter-select" id="during-cutover-status-filter" onchange="applyFilters('during-cutover')">
                                <option value="">All Statuses</option>
                                <option value="completed">Completed</option>
                                <option value="in-progress">In Progress</option>
                                <option value="not-started">Not Started</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Filter by Assignee:</label>
                            <select class="filter-select" id="during-cutover-assignee-filter" onchange="applyFilters('during-cutover')">
                                <option value="">All Assignees</option>
                            </select>
                        </div>
                        <button class="clear-filters-btn" onclick="clearFilters('during-cutover')">Clear Filters</button>
                    </div>

                    <div class="progress-section">
                        <h4>During Cutover Progress</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="duringCutoverProgress" style="width: 0%"></div>
                            <div class="progress-text" id="duringCutoverProgressText">0% Complete</div>
                        </div>
                        <div class="progress-stats">
                            <div><strong>Total:</strong> <span id="duringCutoverTotalTasks">0</span></div>
                            <div><strong>Completed:</strong> <span id="duringCutoverCompletedTasks">0</span></div>
                            <div><strong>Remaining:</strong> <span id="duringCutoverRemainingTasks">0</span></div>
                        </div>
                    </div>

                    <div class="milestones-highlight">
                        <h3>Critical Milestones</h3>
                        <div id="milestones-container">
                            <!-- Milestones will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="content-wrapper">
                        <div class="tasks-section">
                            <h3>Tasks</h3>
                            <div id="during-cutover-tasks" class="tasks-container">
                                <!-- Tasks will be dynamically loaded here -->
                            </div>
                        </div>
                        <div class="timeline-section">
                            <h3>Timeline View</h3>
                            <div class="timeline-visual" id="during-cutover-timeline">
                                <div class="timeline-line"></div>
                                <!-- Timeline items will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('addTaskModal')">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title" id="taskModalTitle">Add New Task</h2>
            </div>
            <form id="addTaskForm">
                <div class="form-group">
                    <label class="form-label">Task Title</label>
                    <input type="text" id="taskTitle" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="taskDescription" class="form-textarea" placeholder="Detailed description of the task"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Main Assignee</label>
                    <input type="text" id="taskAssignee" class="form-input" placeholder="Who is responsible for this task">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select id="taskPriority" class="form-select">
                        <option value="high">High</option>
                        <option value="medium" selected>Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Due Date & Time</label>
                    <input type="datetime-local" id="taskDueDate" class="form-datetime">
                </div>

                <div class="form-group">
                    <label class="form-label">Subtasks</label>
                    <div class="subtask-list" id="subtaskList">
                        <div class="subtask-input-group">
                            <input type="text" class="form-input subtask-input" placeholder="Subtask description">
                            <input type="text" class="form-input assignee-input" placeholder="Assignee (optional)">
                            <button type="button" class="add-subtask-btn" onclick="addSubtaskToForm()">Add</button>
                        </div>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addTaskModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="taskSubmitBtn">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Milestone Modal -->
    <div id="addMilestoneModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('addMilestoneModal')">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title" id="milestoneModalTitle">Add New Milestone</h2>
            </div>
            <form id="addMilestoneForm">
                <div class="form-group">
                    <label class="form-label">Milestone Title</label>
                    <input type="text" id="milestoneTitle" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="milestoneDescription" class="form-textarea" placeholder="Description of this milestone"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Date & Time</label>
                    <input type="datetime-local" id="milestoneDate" class="form-datetime" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select id="milestoneType" class="form-select">
                        <option value="freeze">Freeze Date</option>
                        <option value="deadline">Deadline</option>
                        <option value="checkpoint">Checkpoint</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addMilestoneModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="milestoneSubmitBtn">Create Milestone</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Note Modal -->
    <div id="addNoteModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('addNoteModal')">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title" id="noteModalTitle">Add Important Note</h2>
            </div>
            <form id="addNoteForm">
                <div class="form-group">
                    <label class="form-label">Note Title</label>
                    <input type="text" id="noteTitle" class="form-input" required placeholder="Brief title for the note">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Note Content</label>
                    <textarea id="noteContent" class="form-textarea" required placeholder="Important information to highlight..."></textarea>
                </div>

                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addNoteModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="noteSubmitBtn">Create Note</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Timeline Entry Modal -->
    <div id="addTimelineEntryModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('addTimelineEntryModal')">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title" id="timelineEntryModalTitle">Add Timeline Entry</h2>
            </div>
            <form id="addTimelineEntryForm">
                <div class="form-group">
                    <label class="form-label">Entry Name</label>
                    <input type="text" id="timelineEntryName" class="form-input" required placeholder="Process or activity name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input type="date" id="timelineStartDate" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input type="date" id="timelineEndDate" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Region</label>
                    <select id="timelineRegion" class="form-select" required>
                        <option value="">Select Region</option>
                        <option value="male">MALE</option>
                        <option value="lk">LK</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Template Type</label>
                    <input type="text" id="timelineTemplate" class="form-input" required placeholder="e.g., Invoice Template, Employee Template">
                </div>

                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addTimelineEntryModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="timelineEntrySubmitBtn">Create Entry</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCqrTCPpCXpLAadzelzJ-dWLH0FNumKPe4",
            authDomain: "finalcutover-fa89c.firebaseapp.com",
            projectId: "finalcutover-fa89c",
            storageBucket: "finalcutover-fa89c.firebasestorage.app",
            messagingSenderId: "23274905325",
            appId: "1:23274905325:web:e3a7d39dc7c30a432176e4",
            measurementId: "G-X0M1FDFTMC"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Application state
        let currentPhase = '';
        let currentNotePhase = '';
        let currentTimelinePhase = '';
        let editingTaskId = null;
        let editingMilestoneId = null;
        let editingNoteId = null;
        let editingTimelineEntryId = null;
        let tasks = {
            'pre-cutover': [],
            'during-cutover': []
        };
        let filteredTasks = {
            'pre-cutover': [],
            'during-cutover': []
        };
        let milestones = [];
        let notes = {
            'pre-cutover': [],
            'during-cutover': []
        };
        let timelineEntries = {
            'pre-cutover': [],
            'during-cutover': []
        };
        let filteredTimelineEntries = {
            'pre-cutover': [],
            'during-cutover': []
        };

        // Phase collapse/expand state
        let phaseStates = {
            'pre-cutover': false,
            'during-cutover': false
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadTasks();
            loadMilestones();
            loadNotes();
            loadTimelineEntries();
            updatePhaseSectionStatuses();
        });

        // Toggle phase section expand/collapse
        function togglePhaseSection(phase) {
            const content = document.getElementById(`${phase}-content`);
            const icon = document.getElementById(`${phase}-icon`);
            
            phaseStates[phase] = !phaseStates[phase];
            
            if (phaseStates[phase]) {
                content.classList.add('expanded');
                icon.classList.add('expanded');
                
                // Ensure the section is expanded when we interact with it
                if (filteredTasks[phase].length === 0) {
                    applyFilters(phase);
                }
            } else {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
            }
        }

        // Update phase section status indicators
        function updatePhaseSectionStatuses() {
            ['pre-cutover', 'during-cutover'].forEach(phase => {
                const totalTasks = tasks[phase].length;
                const completedTasks = tasks[phase].filter(task => task.status === 'completed').length;
                const statusElement = document.getElementById(`${phase}-section-status`);
                
                if (statusElement) {
                    statusElement.textContent = `${completedTasks}/${totalTasks} tasks completed`;
                }
            });
        }

        // Load tasks from Firebase
        async function loadTasks() {
            try {
                const snapshot = await db.collection('migrationTasks').get();
                tasks = {
                    'pre-cutover': [],
                    'during-cutover': []
                };

                snapshot.forEach(doc => {
                    const task = { id: doc.id, ...doc.data() };
                    tasks[task.phase].push(task);
                });

                resetFilters();
                populateAssigneeFilters();
                renderTasks();
                renderTimelines();
                updateProgress();
                updatePhaseSectionStatuses();
            } catch (error) {
                console.error('Error loading tasks:', error);
                loadSampleData();
            }
        }

        // Load milestones from Firebase
        async function loadMilestones() {
            try {
                const snapshot = await db.collection('migrationMilestones').get();
                milestones = [];

                snapshot.forEach(doc => {
                    const milestone = { id: doc.id, ...doc.data() };
                    milestones.push(milestone);
                });

                renderMilestones();
                renderTimelines();
            } catch (error) {
                console.error('Error loading milestones:', error);
                loadSampleMilestones();
            }
        }

        // Load notes from Firebase
        async function loadNotes() {
            try {
                const snapshot = await db.collection('migrationNotes').get();
                notes = {
                    'pre-cutover': [],
                    'during-cutover': []
                };

                snapshot.forEach(doc => {
                    const note = { id: doc.id, ...doc.data() };
                    notes[note.phase].push(note);
                });

                renderNotes();
            } catch (error) {
                console.error('Error loading notes:', error);
                // Notes are optional, so no sample data needed
            }
        }

        // Load timeline entries from Firebase
        async function loadTimelineEntries() {
            try {
                const snapshot = await db.collection('migrationTimelineEntries').get();
                timelineEntries = {
                    'pre-cutover': [],
                    'during-cutover': []
                };

                snapshot.forEach(doc => {
                    const entry = { id: doc.id, ...doc.data() };
                    timelineEntries[entry.phase].push(entry);
                });

                filteredTimelineEntries['pre-cutover'] = [...timelineEntries['pre-cutover']];
                filteredTimelineEntries['during-cutover'] = [...timelineEntries['during-cutover']];
                
                populateTimelineFilters();
                renderTimelineEntries();
            } catch (error) {
                console.error('Error loading timeline entries:', error);
                loadSampleTimelineEntries();
            }
        }

        // Save task to Firebase
        async function saveTask(task) {
            try {
                if (task.id && task.id !== 'new') {
                    await db.collection('migrationTasks').doc(task.id).update(task);
                } else {
                    const docRef = await db.collection('migrationTasks').add(task);
                    task.id = docRef.id;
                }
                return true;
            } catch (error) {
                console.error('Error saving task:', error);
                return false;
            }
        }

        // Save milestone to Firebase
        async function saveMilestone(milestone) {
            try {
                if (milestone.id && milestone.id !== 'new') {
                    await db.collection('migrationMilestones').doc(milestone.id).update(milestone);
                } else {
                    const docRef = await db.collection('migrationMilestones').add(milestone);
                    milestone.id = docRef.id;
                }
                return true;
            } catch (error) {
                console.error('Error saving milestone:', error);
                return false;
            }
        }

        // Save note to Firebase
        async function saveNote(note) {
            try {
                if (note.id && note.id !== 'new') {
                    await db.collection('migrationNotes').doc(note.id).update(note);
                } else {
                    const docRef = await db.collection('migrationNotes').add(note);
                    note.id = docRef.id;
                }
                return true;
            } catch (error) {
                console.error('Error saving note:', error);
                return false;
            }
        }

        // Save timeline entry to Firebase
        async function saveTimelineEntry(entry) {
            try {
                if (entry.id && entry.id !== 'new') {
                    await db.collection('migrationTimelineEntries').doc(entry.id).update(entry);
                } else {
                    const docRef = await db.collection('migrationTimelineEntries').add(entry);
                    entry.id = docRef.id;
                }
                return true;
            } catch (error) {
                console.error('Error saving timeline entry:', error);
                return false;
            }
        }

        // Delete functions
        async function deleteTaskFromFirebase(taskId) {
            try {
                await db.collection('migrationTasks').doc(taskId).delete();
                return true;
            } catch (error) {
                console.error('Error deleting task:', error);
                return false;
            }
        }

        async function deleteMilestoneFromFirebase(milestoneId) {
            try {
                await db.collection('migrationMilestones').doc(milestoneId).delete();
                return true;
            } catch (error) {
                console.error('Error deleting milestone:', error);
                return false;
            }
        }

        async function deleteNoteFromFirebase(noteId) {
            try {
                await db.collection('migrationNotes').doc(noteId).delete();
                return true;
            } catch (error) {
                console.error('Error deleting note:', error);
                return false;
            }
        }

        async function deleteTimelineEntryFromFirebase(entryId) {
            try {
                await db.collection('migrationTimelineEntries').doc(entryId).delete();
                return true;
            } catch (error) {
                console.error('Error deleting timeline entry:', error);
                return false;
            }
        }

        // Timeline Entry Filtering functions
        function populateTimelineFilters() {
            const allRegions = new Set();
            const allTemplates = new Set();
            
            ['pre-cutover', 'during-cutover'].forEach(phase => {
                timelineEntries[phase].forEach(entry => {
                    if (entry.region) allRegions.add(entry.region);
                    if (entry.template) allTemplates.add(entry.template);
                });
            });

            ['pre-cutover', 'during-cutover'].forEach(phase => {
                const regionSelect = document.getElementById(`${phase}-timeline-region-filter`);
                const templateSelect = document.getElementById(`${phase}-timeline-template-filter`);
                
                if(regionSelect) {
                    regionSelect.innerHTML = '<option value="">All Regions</option>';
                    Array.from(allRegions).sort().forEach(region => {
                        const option = document.createElement('option');
                        option.value = region;
                        option.textContent = region.toUpperCase();
                        regionSelect.appendChild(option);
                    });
                }

                if(templateSelect) {
                    templateSelect.innerHTML = '<option value="">All Templates</option>';
                    Array.from(allTemplates).sort().forEach(template => {
                        const option = document.createElement('option');
                        option.value = template;
                        option.textContent = template;
                        templateSelect.appendChild(option);
                    });
                }
            });
        }

        function applyTimelineFilters(phase) {
            const regionFilter = document.getElementById(`${phase}-timeline-region-filter`).value;
            const templateFilter = document.getElementById(`${phase}-timeline-template-filter`).value;

            filteredTimelineEntries[phase] = timelineEntries[phase].filter(entry => {
                const regionMatch = !regionFilter || entry.region === regionFilter;
                const templateMatch = !templateFilter || entry.template === templateFilter;
                return regionMatch && templateMatch;
            });

            renderFilteredTimelineEntries(phase);
        }

        function clearTimelineFilters(phase) {
            if(document.getElementById(`${phase}-timeline-region-filter`)) {
                document.getElementById(`${phase}-timeline-region-filter`).value = '';
            }
            if(document.getElementById(`${phase}-timeline-template-filter`)) {
                document.getElementById(`${phase}-timeline-template-filter`).value = '';
            }
            filteredTimelineEntries[phase] = timelineEntries[phase];
            renderFilteredTimelineEntries(phase);
        }

        function renderFilteredTimelineEntries(phase) {
            const container = document.getElementById(`${phase}-process-timeline`);
            if (!container) return;
            container.innerHTML = '';

            if (!filteredTimelineEntries[phase] || filteredTimelineEntries[phase].length === 0) {
                container.innerHTML = '<div class="no-results-message">No timeline entries match the current filters</div>';
                return;
            }

            filteredTimelineEntries[phase].forEach(entry => {
                container.appendChild(createTimelineEntryElement(entry));
            });
        }

        function createTimelineEntryElement(entry) {
            const entryEl = document.createElement('div');
            entryEl.className = 'timeline-entry';
            entryEl.dataset.id = entry.id;

            const checkboxOrder = ['dataExtracted', 'validationsDone', 'sentToBUs', 'templateFilledWithIssues', 'templateFilledWithoutIssues'];
            const checkboxesHtml = checkboxOrder.map(key => {
                if (entry.checkboxes.hasOwnProperty(key)) {
                    const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    const keyId = key.replace(/\s+/g, '-');
                    return `
                        <div class="timeline-checkbox-item" data-key="${keyId}">
                            <input type="checkbox" id="chk-${entry.id}-${keyId}" class="timeline-checkbox" ${entry.checkboxes[key] ? 'checked' : ''} onchange="updateTimelineCheckbox('${entry.id}', '${entry.phase}', '${key}', this.checked)">
                            <label for="chk-${entry.id}-${keyId}" class="timeline-checkbox-label">${label}</label>
                        </div>
                    `;
                }
                return '';
            }).join('');

            entryEl.innerHTML = `
                <div class="timeline-entry-header">
                    <div class="timeline-entry-title">${entry.name}</div>
                    <div class="timeline-entry-flags">
                        <span class="timeline-flag ${entry.region}">${entry.region.toUpperCase()}</span>
                    </div>
                </div>
                <div class="timeline-entry-period">${entry.startDate} to ${entry.endDate}</div>
                <div class="timeline-entry-template">${entry.template}</div>
                <div class="timeline-checkboxes">${checkboxesHtml}</div>
                <div class="timeline-entry-actions">
                    <button class="timeline-action-btn edit" onclick="openEditTimelineEntryModal(event, '${entry.id}', '${entry.phase}')">✏️</button>
                    <button class="timeline-action-btn delete" onclick="deleteTimelineEntry(event, '${entry.id}', '${entry.phase}')">🗑️</button>
                </div>
            `;
            
            updateTimelineEntryAppearance(entry.id, entry.phase, entryEl);
            return entryEl;
        }

        function updateTimelineCheckbox(entryId, phase, key, isChecked) {
            const entry = timelineEntries[phase].find(e => e.id === entryId);
            if (entry) {
                entry.checkboxes[key] = isChecked;

                if (key === 'templateFilledWithoutIssues' && isChecked) {
                    entry.checkboxes.templateFilledWithIssues = false;
                } else if (key === 'templateFilledWithIssues' && isChecked) {
                    entry.checkboxes.templateFilledWithoutIssues = false;
                }

                saveTimelineEntry(entry).then(() => {
                    const entryEl = document.querySelector(`.timeline-entry[data-id='${entryId}']`);
                    if (entryEl) {
                        const newEntryEl = createTimelineEntryElement(entry);
                        entryEl.parentNode.replaceChild(newEntryEl, entryEl);
                        updateTimelineEntryAppearance(entryId, phase, newEntryEl);
                    }
                });
            }
        }

        function updateTimelineEntryAppearance(entryId, phase, entryEl) {
            if (!entryEl) {
                entryEl = document.querySelector(`.timeline-entry[data-id='${entryId}']`);
            }
            if (!entryEl) return;

            const entry = timelineEntries[phase].find(e => e.id === entryId);
            if (!entry) return;

            const withoutIssuesEl = entryEl.querySelector('[data-key="templateFilledWithoutIssues"]');
            const withIssuesEl = entryEl.querySelector('[data-key="templateFilledWithIssues"]');

            if (entry.checkboxes.templateFilledWithoutIssues) {
                withIssuesEl.classList.add('hidden-by-logic');
            } else {
                withIssuesEl.classList.remove('hidden-by-logic');
            }

            if (entry.checkboxes.templateFilledWithIssues) {
                withoutIssuesEl.classList.add('hidden-by-logic');
            } else {
                withoutIssuesEl.classList.remove('hidden-by-logic');
            }

            const allChecked = Object.values(entry.checkboxes).every(val => val === true);
            if (allChecked) {
                entryEl.classList.add('all-checked');
            } else {
                entryEl.classList.remove('all-checked');
            }
        }

        function openEditTimelineEntryModal(event, entryId, phase) {
            event.stopPropagation();
            editingTimelineEntryId = entryId;
            currentTimelinePhase = phase;
            const entry = timelineEntries[phase].find(t => t.id === entryId);
            
            document.getElementById('timelineEntryModalTitle').textContent = 'Edit Timeline Entry';
            document.getElementById('timelineEntrySubmitBtn').textContent = 'Update Entry';
            
            document.getElementById('timelineEntryName').value = entry.name;
            document.getElementById('timelineStartDate').value = entry.startDate;
            document.getElementById('timelineEndDate').value = entry.endDate;
            document.getElementById('timelineRegion').value = entry.region;
            document.getElementById('timelineTemplate').value = entry.template;

            openModal('addTimelineEntryModal');
        }

        function deleteTimelineEntry(event, entryId, phase) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this timeline entry?')) {
                deleteTimelineEntryFromFirebase(entryId).then(success => {
                    if (success) {
                        loadTimelineEntries();
                    }
                });
            }
        }

        function renderTimelineEntries() {
            renderFilteredTimelineEntries('pre-cutover');
            renderFilteredTimelineEntries('during-cutover');
        }

        // Load sample data for demonstration
        function loadSampleData() {
            tasks = {
                'pre-cutover': [
                    {
                        id: '1',
                        title: 'Environment Setup',
                        description: 'Prepare production and staging environments',
                        phase: 'pre-cutover',
                        priority: 'high',
                        assignee: 'John Doe',
                        dueDate: '2025-07-15T09:00',
                        status: 'completed',
                        subtasks: [
                            { text: 'Configure servers', assignee: 'John Doe', completed: true },
                            { text: 'Setup databases', assignee: 'Jane Smith', completed: true },
                            { text: 'Network configuration', assignee: '', completed: false }
                        ]
                    },
                    {
                        id: '2',
                        title: 'Data Backup',
                        description: 'Complete backup of all critical data',
                        phase: 'pre-cutover',
                        priority: 'high',
                        assignee: 'Sarah Wilson',
                        dueDate: '2025-07-20T14:00',
                        status: 'in-progress',
                        subtasks: [
                            { text: 'Database backup', assignee: 'Sarah Wilson', completed: true },
                            { text: 'File system backup', assignee: '', completed: false }
                        ]
                    }
                ],
                'during-cutover': [
                    {
                        id: '3',
                        title: 'DNS Switch',
                        description: 'Update DNS records to point to new servers',
                        phase: 'during-cutover',
                        priority: 'high',
                        assignee: 'Alex Green',
                        dueDate: '2025-07-25T16:00',
                        status: 'not-started',
                        subtasks: [
                            { text: 'Update A records', assignee: '', completed: false },
                            { text: 'Verify propagation', assignee: 'Lisa White', completed: false }
                        ]
                    }
                ]
            };
            resetFilters();
            populateAssigneeFilters();
            renderTasks();
            renderTimelines();
            updateProgress();
            updatePhaseSectionStatuses();
        }

        // Load sample milestones for demonstration
        function loadSampleMilestones() {
            milestones = [
                {
                    id: '1',
                    title: 'Job Freeze Date',
                    description: 'All new jobs must be frozen',
                    date: '2025-07-22T17:00',
                    type: 'freeze'
                },
                {
                    id: '2',
                    title: 'Invoice Freeze Date',
                    description: 'All invoicing processes must be completed',
                    date: '2025-07-24T12:00',
                    type: 'freeze'
                }
            ];
            renderMilestones();
            renderTimelines();
        }

        // Load sample timeline entries for demonstration
        function loadSampleTimelineEntries() {
            timelineEntries = {
                'pre-cutover': [
                    {
                        id: '1',
                        name: 'Invoice Processing',
                        startDate: '2025-07-01',
                        endDate: '2025-07-15',
                        region: 'male',
                        template: 'Invoice Template V2.1',
                        phase: 'pre-cutover',
                        checkboxes: {
                            dataExtracted: false,
                            validationsDone: false,
                            sentToBUs: false,
                            templateFilledWithIssues: false,
                            templateFilledWithoutIssues: false
                        }
                    },
                    {
                        id: '2',
                        name: 'Employee Data Migration',
                        startDate: '2025-07-10',
                        endDate: '2025-07-20',
                        region: 'lk',
                        template: 'Employee Template V1.3',
                        phase: 'pre-cutover',
                        checkboxes: {
                            dataExtracted: true,
                            validationsDone: true,
                            sentToBUs: false,
                            templateFilledWithIssues: false,
                            templateFilledWithoutIssues: false
                        }
                    }
                ],
                'during-cutover': [
                    {
                        id: '3',
                        name: 'Final Invoice Reconciliation',
                        startDate: '2025-07-25',
                        endDate: '2025-07-26',
                        region: 'male',
                        template: 'Reconciliation Template V1.0',
                        phase: 'during-cutover',
                        checkboxes: {
                            dataExtracted: false,
                            validationsDone: false,
                            sentToBUs: false,
                            templateFilledWithIssues: false,
                            templateFilledWithoutIssues: false
                        }
                    }
                ]
            };
            filteredTimelineEntries['pre-cutover'] = [...timelineEntries['pre-cutover']];
            filteredTimelineEntries['during-cutover'] = [...timelineEntries['during-cutover']];
            populateTimelineFilters();
            renderTimelineEntries();
        }

        // Filtering functions
        function populateAssigneeFilters() {
            const allAssignees = new Set();
            
            ['pre-cutover', 'during-cutover'].forEach(phase => {
                tasks[phase].forEach(task => {
                    if (task.assignee) allAssignees.add(task.assignee);
                    task.subtasks.forEach(subtask => {
                        if (subtask.assignee) allAssignees.add(subtask.assignee);
                    });
                });
            });

            ['pre-cutover', 'during-cutover'].forEach(phase => {
                const select = document.getElementById(`${phase}-assignee-filter`);
                select.innerHTML = '<option value="">All Assignees</option>';
                
                Array.from(allAssignees).sort().forEach(assignee => {
                    const option = document.createElement('option');
                    option.value = assignee;
                    option.textContent = assignee;
                    select.appendChild(option);
                });
            });
        }

        function applyFilters(phase) {
            const statusFilter = document.getElementById(`${phase}-status-filter`).value;
            const assigneeFilter = document.getElementById(`${phase}-assignee-filter`).value;

            filteredTasks[phase] = tasks[phase].filter(task => {
                const statusMatch = !statusFilter || task.status === statusFilter;
                const assigneeMatch = !assigneeFilter || 
                    task.assignee === assigneeFilter ||
                    task.subtasks.some(subtask => subtask.assignee === assigneeFilter);
                
                return statusMatch && assigneeMatch;
            });

            renderFilteredTasks(phase);
            updateProgress();
        }

        function clearFilters(phase) {
            document.getElementById(`${phase}-status-filter`).value = '';
            document.getElementById(`${phase}-assignee-filter`).value = '';
            filteredTasks[phase] = tasks[phase];
            renderFilteredTasks(phase);
            updateProgress();
        }

        function resetFilters() {
            filteredTasks['pre-cutover'] = tasks['pre-cutover'];
            filteredTasks['during-cutover'] = tasks['during-cutover'];
        }

        // Render functions
        function renderTasks() {
            resetFilters();
            renderFilteredTasks('pre-cutover');
            renderFilteredTasks('during-cutover');
        }

        function renderFilteredTasks(phase) {
            const container = document.getElementById(`${phase}-tasks`);
            container.innerHTML = '';

            if (filteredTasks[phase].length === 0) {
                container.innerHTML = '<div class="no-results-message">No tasks match the current filters</div>';
                return;
            }

            filteredTasks[phase].forEach(task => {
                container.appendChild(createTaskElement(task));
            });
        }

        function renderNotes() {
            ['pre-cutover', 'during-cutover'].forEach(phase => {
                const container = document.getElementById(`${phase}-notes-container`);
                const section = document.getElementById(`${phase}-notes-section`);
                const countSpan = document.getElementById(`${phase}-notes-count`);

                if (notes[phase].length > 0) {
                    section.style.display = 'block';
                    countSpan.textContent = notes[phase].length;
                    container.innerHTML = '';
                    notes[phase].forEach(note => {
                        container.appendChild(createNoteElement(note));
                    });
                } else {
                    section.style.display = 'none';
                }
            });
        }

        function renderMilestones() {
            const container = document.getElementById('milestones-container');
            container.innerHTML = '';

            if (milestones.length === 0) {
                container.innerHTML = '<div class="no-results-message">No milestones defined yet.</div>';
                return;
            }

            milestones.sort((a, b) => new Date(a.date) - new Date(b.date));

            milestones.forEach(milestone => {
                container.appendChild(createMilestoneElement(milestone));
            });
        }

        function renderTimelines() {
            ['pre-cutover', 'during-cutover'].forEach(phase => {
                const container = document.getElementById(`${phase}-timeline`);
                container.innerHTML = '<div class="timeline-line"></div>';

                const phaseTasks = tasks[phase];
                const phaseMilestones = milestones;

                const allItems = [
                    ...phaseTasks.map(t => ({ ...t, type: 'task', date: t.dueDate })),
                    ...phaseMilestones.map(m => ({ ...m, type: 'milestone' }))
                ].filter(item => item.date);

                allItems.sort((a, b) => new Date(a.date) - new Date(b.date));

                if (allItems.length === 0) {
                    container.innerHTML += '<div class="no-results-message">No timeline events.</div>';
                    return;
                }

                allItems.forEach(item => {
                    container.appendChild(createTimelineItemElement(item));
                });
            });
        }

        // Element creation functions
        function createTaskElement(task) {
            const taskEl = document.createElement('div');
            taskEl.className = `task-item ${task.status.replace(' ', '-')}`;
            taskEl.dataset.id = task.id;

            const subtasksHtml = task.subtasks.map((sub, index) => `
                <div class="subtask">
                    <input type="checkbox" class="subtask-checkbox" id="subtask-${task.id}-${index}" ${sub.completed ? 'checked' : ''} onchange="toggleSubtask('${task.id}', ${index}, this.checked)">
                    <label for="subtask-${task.id}-${index}" class="subtask-text">${sub.text}</label>
                    ${sub.assignee ? `<span class="subtask-assignee">${sub.assignee}</span>` : ''}
                </div>
            `).join('');

            taskEl.innerHTML = `
                <div class="task-header" onclick="toggleTaskDetails('${task.id}')">
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            Due: ${new Date(task.dueDate).toLocaleString()} | Priority: ${task.priority}
                            ${task.assignee ? `<span class="task-assignee">${task.assignee}</span>` : ''}
                        </div>
                    </div>
                    <div class="task-status">
                        <span class="status-badge status-${task.status.replace(' ', '-')}">${task.status}</span>
                        <div class="task-actions">
                            <button class="task-icon-btn edit" onclick="openEditTaskModal(event, '${task.id}')">✏️</button>
                            <button class="task-icon-btn delete" onclick="deleteTask(event, '${task.id}')">🗑️</button>
                        </div>
                        <span class="expand-icon" id="expand-icon-${task.id}">▼</span>
                    </div>
                </div>
                <div class="task-details" id="task-details-${task.id}">
                    <p>${task.description}</p>
                    <h4>Subtasks</h4>
                    <div class="subtask-list">${subtasksHtml}</div>
                </div>
            `;
            return taskEl;
        }

        function createNoteElement(note) {
            const noteEl = document.createElement('div');
            noteEl.className = 'note-item';
            noteEl.dataset.id = note.id;

            noteEl.innerHTML = `
                <div class="note-content">
                    <div class="note-title">${note.title}</div>
                    <div class="note-text">${note.content}</div>
                    <div class="note-timestamp">Created: ${new Date(note.timestamp).toLocaleString()}</div>
                </div>
                <div class="note-actions">
                    <button class="icon-btn" onclick="openEditNoteModal(event, '${note.id}', '${note.phase}')">✏️</button>
                    <button class="icon-btn" onclick="deleteNote(event, '${note.id}', '${note.phase}')">🗑️</button>
                </div>
            `;
            return noteEl;
        }

        function createMilestoneElement(milestone) {
            const milestoneEl = document.createElement('div');
            milestoneEl.className = 'milestone-item';
            milestoneEl.dataset.id = milestone.id;

            milestoneEl.innerHTML = `
                <div>
                    <div class="milestone-title">${milestone.title} (${milestone.type})</div>
                    <div class="milestone-datetime">${new Date(milestone.date).toLocaleString()}</div>
                </div>
                <div class="milestone-actions">
                    <button class="icon-btn" onclick="openEditMilestoneModal(event, '${milestone.id}')">✏️</button>
                    <button class="icon-btn" onclick="deleteMilestone(event, '${milestone.id}')">🗑️</button>
                </div>
            `;
            return milestoneEl;
        }

        function createTimelineItemElement(item) {
            const itemEl = document.createElement('div');
            itemEl.className = 'timeline-item';

            const date = new Date(item.date);
            const isMilestone = item.type === 'milestone';

            itemEl.innerHTML = `
                <div class="timeline-date">${date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}</div>
                <div class="timeline-dot ${isMilestone ? 'milestone' : `task-${item.status.replace(' ', '-')}`}"></div>
                <div class="timeline-content ${isMilestone ? 'milestone-content' : ''}">
                    ${item.title}
                </div>
            `;
            return itemEl;
        }

        // Modal handling
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function openAddTaskModal(phase) {
            currentPhase = phase;
            editingTaskId = null;
            document.getElementById('taskModalTitle').textContent = 'Add New Task';
            document.getElementById('taskSubmitBtn').textContent = 'Create Task';
            document.getElementById('addTaskForm').reset();
            document.getElementById('subtaskList').innerHTML = `
                <div class="subtask-input-group">
                    <input type="text" class="form-input subtask-input" placeholder="Subtask description">
                    <input type="text" class="form-input assignee-input" placeholder="Assignee (optional)">
                    <button type="button" class="add-subtask-btn" onclick="addSubtaskToForm()">Add</button>
                </div>
            `;
            openModal('addTaskModal');
        }

        function openEditTaskModal(event, taskId) {
            event.stopPropagation();
            editingTaskId = taskId;
            const task = tasks['pre-cutover'].find(t => t.id === taskId) || tasks['during-cutover'].find(t => t.id === taskId);
            currentPhase = task.phase;
            
            document.getElementById('taskModalTitle').textContent = 'Edit Task';
            document.getElementById('taskSubmitBtn').textContent = 'Update Task';
            
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description;
            document.getElementById('taskAssignee').value = task.assignee;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskDueDate').value = task.dueDate;

            const subtaskList = document.getElementById('subtaskList');
            subtaskList.innerHTML = '';
            task.subtasks.forEach(sub => {
                const subtaskEl = document.createElement('div');
                subtaskEl.className = 'subtask-item';
                subtaskEl.innerHTML = `
                    <input type="text" class="form-input subtask-input" value="${sub.text}">
                    <input type="text" class="form-input assignee-input" value="${sub.assignee || ''}">
                    <button type="button" class="subtask-delete-btn" onclick="this.parentElement.remove()">Remove</button>
                `;
                subtaskList.appendChild(subtaskEl);
            });
            subtaskList.innerHTML += `
                <div class="subtask-input-group">
                    <input type="text" class="form-input subtask-input" placeholder="Subtask description">
                    <input type="text" class="form-input assignee-input" placeholder="Assignee (optional)">
                    <button type="button" class="add-subtask-btn" onclick="addSubtaskToForm()">Add</button>
                </div>
            `;

            openModal('addTaskModal');
        }

        function openAddMilestoneModal() {
            editingMilestoneId = null;
            document.getElementById('milestoneModalTitle').textContent = 'Add New Milestone';
            document.getElementById('milestoneSubmitBtn').textContent = 'Create Milestone';
            document.getElementById('addMilestoneForm').reset();
            openModal('addMilestoneModal');
        }

        function openEditMilestoneModal(event, milestoneId) {
            event.stopPropagation();
            editingMilestoneId = milestoneId;
            const milestone = milestones.find(m => m.id === milestoneId);
            
            document.getElementById('milestoneModalTitle').textContent = 'Edit Milestone';
            document.getElementById('milestoneSubmitBtn').textContent = 'Update Milestone';
            
            document.getElementById('milestoneTitle').value = milestone.title;
            document.getElementById('milestoneDescription').value = milestone.description;
            document.getElementById('milestoneDate').value = milestone.date;
            document.getElementById('milestoneType').value = milestone.type;

            openModal('addMilestoneModal');
        }

        function openAddNoteModal(phase) {
            currentNotePhase = phase;
            editingNoteId = null;
            document.getElementById('noteModalTitle').textContent = 'Add Important Note';
            document.getElementById('noteSubmitBtn').textContent = 'Create Note';
            document.getElementById('addNoteForm').reset();
            openModal('addNoteModal');
        }

        function openEditNoteModal(event, noteId, phase) {
            event.stopPropagation();
            editingNoteId = noteId;
            currentNotePhase = phase;
            const note = notes[phase].find(n => n.id === noteId);
            
            document.getElementById('noteModalTitle').textContent = 'Edit Note';
            document.getElementById('noteSubmitBtn').textContent = 'Update Note';
            
            document.getElementById('noteTitle').value = note.title;
            document.getElementById('noteContent').value = note.content;

            openModal('addNoteModal');
        }

        function openAddTimelineEntryModal(phase) {
            currentTimelinePhase = phase;
            editingTimelineEntryId = null;
            document.getElementById('timelineEntryModalTitle').textContent = 'Add Timeline Entry';
            document.getElementById('timelineEntrySubmitBtn').textContent = 'Create Entry';
            document.getElementById('addTimelineEntryForm').reset();
            openModal('addTimelineEntryModal');
        }

        // Form submissions
        document.getElementById('addTaskForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const task = {
                id: editingTaskId,
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                assignee: document.getElementById('taskAssignee').value,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value,
                phase: currentPhase,
                status: editingTaskId ? (tasks[currentPhase].find(t => t.id === editingTaskId).status) : 'not-started',
                subtasks: Array.from(document.querySelectorAll('#subtaskList .subtask-item')).map(el => ({
                    text: el.querySelector('.subtask-input').value,
                    assignee: el.querySelector('.assignee-input').value,
                    completed: false // This should be handled properly
                }))
            };

            const success = await saveTask(task);
            if (success) {
                closeModal('addTaskModal');
                loadTasks();
            }
        });

        document.getElementById('addMilestoneForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const milestone = {
                id: editingMilestoneId,
                title: document.getElementById('milestoneTitle').value,
                description: document.getElementById('milestoneDescription').value,
                date: document.getElementById('milestoneDate').value,
                type: document.getElementById('milestoneType').value
            };

            const success = await saveMilestone(milestone);
            if (success) {
                closeModal('addMilestoneModal');
                loadMilestones();
            }
        });

        document.getElementById('addNoteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const note = {
                id: editingNoteId,
                title: document.getElementById('noteTitle').value,
                content: document.getElementById('noteContent').value,
                phase: currentNotePhase,
                timestamp: new Date().toISOString()
            };

            const success = await saveNote(note);
            if (success) {
                closeModal('addNoteModal');
                loadNotes();
            }
        });

        document.getElementById('addTimelineEntryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const entry = {
                id: editingTimelineEntryId,
                name: document.getElementById('timelineEntryName').value,
                startDate: document.getElementById('timelineStartDate').value,
                endDate: document.getElementById('timelineEndDate').value,
                region: document.getElementById('timelineRegion').value,
                template: document.getElementById('timelineTemplate').value,
                phase: currentTimelinePhase,
                checkboxes: editingTimelineEntryId ? (timelineEntries[currentTimelinePhase].find(t => t.id === editingTimelineEntryId).checkboxes) : {
                    dataExtracted: false,
                    validationsDone: false,
                    sentToBUs: false,
                    templateFilledWithIssues: false,
                    templateFilledWithoutIssues: false
                }
            };

            const success = await saveTimelineEntry(entry);
            if (success) {
                closeModal('addTimelineEntryModal');
                loadTimelineEntries();
            }
        });

        // Task interaction
        function toggleTaskDetails(taskId) {
            const details = document.getElementById(`task-details-${taskId}`);
            const icon = document.getElementById(`expand-icon-${taskId}`);
            details.classList.toggle('expanded');
            icon.classList.toggle('rotated');
        }

        async function toggleSubtask(taskId, subtaskIndex, isCompleted) {
            const task = tasks['pre-cutover'].find(t => t.id === taskId) || tasks['during-cutover'].find(t => t.id === taskId);
            if (task) {
                task.subtasks[subtaskIndex].completed = isCompleted;
                
                const allSubtasksCompleted = task.subtasks.every(sub => sub.completed);
                if (allSubtasksCompleted) {
                    task.status = 'completed';
                } else if (task.subtasks.some(sub => sub.completed)) {
                    task.status = 'in-progress';
                } else {
                    task.status = 'not-started';
                }

                await saveTask(task);
                loadTasks();
            }
        }

        function addSubtaskToForm() {
            const container = document.getElementById('subtaskList');
            const inputGroup = container.querySelector('.subtask-input-group');
            const text = inputGroup.querySelector('.subtask-input').value;
            const assignee = inputGroup.querySelector('.assignee-input').value;

            if (text) {
                const subtaskEl = document.createElement('div');
                subtaskEl.className = 'subtask-item';
                subtaskEl.innerHTML = `
                    <input type="text" class="form-input subtask-input" value="${text}">
                    <input type="text" class="form-input assignee-input" value="${assignee || ''}">
                    <button type="button" class="subtask-delete-btn" onclick="this.parentElement.remove()">Remove</button>
                `;
                container.insertBefore(subtaskEl, inputGroup);
                inputGroup.querySelector('.subtask-input').value = '';
                inputGroup.querySelector('.assignee-input').value = '';
            }
        }

        async function deleteTask(event, taskId) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this task?')) {
                const success = await deleteTaskFromFirebase(taskId);
                if (success) {
                    loadTasks();
                }
            }
        }

        async function deleteMilestone(event, milestoneId) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this milestone?')) {
                const success = await deleteMilestoneFromFirebase(milestoneId);
                if (success) {
                    loadMilestones();
                }
            }
        }

        async function deleteNote(event, noteId, phase) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this note?')) {
                const success = await deleteNoteFromFirebase(noteId);
                if (success) {
                    loadNotes();
                }
            }
        }

        // Progress calculation
        function updateProgress() {
            ['pre-cutover', 'during-cutover'].forEach(phase => {
                const phaseTasks = tasks[phase];
                const total = phaseTasks.length;
                const completed = phaseTasks.filter(t => t.status === 'completed').length;
                const percentage = total > 0 ? (completed / total) * 100 : 0;

                const progressFill = document.getElementById(`${phase === 'pre-cutover' ? 'preCutover' : 'duringCutover'}Progress`);
                const progressText = document.getElementById(`${phase === 'pre-cutover' ? 'preCutover' : 'duringCutover'}ProgressText`);
                
                progressFill.style.width = `${percentage}%`;
                progressText.textContent = `${Math.round(percentage)}% Complete`;

                document.getElementById(`${phase === 'pre-cutover' ? 'preCutover' : 'duringCutover'}TotalTasks`).textContent = total;
                document.getElementById(`${phase === 'pre-cutover' ? 'preCutover' : 'duringCutover'}CompletedTasks`).textContent = completed;
                document.getElementById(`${phase === 'pre-cutover' ? 'preCutover' : 'duringCutover'}RemainingTasks`).textContent = total - completed;
            });
        }
    </script>
</body>
</html>
